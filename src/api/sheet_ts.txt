import axios from 'axios';
import { APIGatewayProxyEvent, APIGatewayEventRequestContext, APIGatewayProxyCallback} from 'AWSLambda';

/*
event = {
    "path": "Path parameter",
    "httpMethod": "Incoming request's method name"
    "headers": {Incoming request headers}
    "queryStringParameters": {query string parameters }
    "body": "A JSON string of the request payload."
    "isBase64Encoded": "A boolean flag to indicate if the applicable request payload is Base64-encode"
}
callback(err,foo) in which foo = {
    "isBase64Encoded": true|false,
    "statusCode": httpStatusCode,
    "headers": { "headerName": "headerValue", ... },
    "body": "..."
}

APIGatewayProxyResult

APIGatewayProxyCallback

*/

function handler(
    event: APIGatewayProxyEvent,
    context: APIGatewayEventRequestContext,
    callback: APIGatewayProxyCallback) {
    getSheet().then(data => {
        callback(null, {
            statusCode: 200,
            body: data
        });
    }, err => callback(err));
}

function getSheet(): Promise<any> {
    let sheetId = '1_owEhU0Ewa6Lc20jhhb5uB4uG1CW9ZEkId5nYOzxdts';
    let config = {
        baseURL: 'https://sheets.googleapis.com',
        timeout: 600000,
        responseType: 'json',
        params: { key: 'AIzaSyDUlgg4ejZjOnSRjjA5QDCqU8YrL7QQU3E' }
    };
    return axios.get('/v4/spreadsheets/'+sheetId+'/values/Sheet1!A1:D5', config)
        .then(response => response.data);
}
